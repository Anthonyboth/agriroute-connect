name: iOS Build REAL

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.2'
    
    - name: Install CocoaPods dependencies
      run: |
        cd ios/App
        pod install
    
    - name: Build iOS App (Debug)
      run: |
        cd ios/App
        xcodebuild -workspace App.xcworkspace -scheme App -configuration Debug -destination 'generic/platform=iOS' CODE_SIGNING_ALLOWED=NO
    
    - name: Build iOS App (Release)
      run: |
        cd ios/App
        xcodebuild -workspace App.xcworkspace -scheme App -configuration Release -destination 'generic/platform=iOS' CODE_SIGNING_ALLOWED=NO
    
    - name: List build products
      run: |
        cd ios/App
        find build -name "*.app" -o -name "*.ipa" 2>/dev/null || echo "No build products found"
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: iOS-Build-Products
        path: ios/App/build/
        retention-days: 1
