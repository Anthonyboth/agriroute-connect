-- Fix RLS policies for user_devices table to allow device registration during signup\n-- Drop problematic policies\nDROP POLICY IF EXISTS "Users can insert own devices" ON public.user_devices;\nDROP POLICY IF EXISTS "Users can insert their own devices" ON public.user_devices;\n\n-- Create new simplified INSERT policy that doesn't require profile to exist\nCREATE POLICY "Authenticated users can register devices"\nON public.user_devices\nFOR INSERT\nWITH CHECK (auth.uid() IS NOT NULL);\n\n-- Keep SELECT policy but simplified\nDROP POLICY IF EXISTS "Users can view own devices" ON public.user_devices;\nDROP POLICY IF EXISTS "Users can view their own devices" ON public.user_devices;\n\nCREATE POLICY "Users can view their devices"\nON public.user_devices\nFOR SELECT\nUSING (\n  user_id IN (SELECT id FROM profiles WHERE user_id = auth.uid())\n  OR auth.uid() IS NOT NULL\n);\n\n-- Keep UPDATE policy but simplified\nDROP POLICY IF EXISTS "Users can update own devices" ON public.user_devices;\nDROP POLICY IF EXISTS "Users can update their own devices" ON public.user_devices;\n\nCREATE POLICY "Users can update their devices"\nON public.user_devices\nFOR UPDATE\nUSING (user_id IN (SELECT id FROM profiles WHERE user_id = auth.uid()))\nWITH CHECK (user_id IN (SELECT id FROM profiles WHERE user_id = auth.uid()));\n\n-- Keep DELETE policy\nDROP POLICY IF EXISTS "Users can delete own devices" ON public.user_devices;\nDROP POLICY IF EXISTS "Users can delete their own devices" ON public.user_devices;\n\nCREATE POLICY "Users can delete their devices"\nON public.user_devices\nFOR DELETE\nUSING (user_id IN (SELECT id FROM profiles WHERE user_id = auth.uid()));